<!DOCTYPE html>
<html lang="en">
<head>
     <link rel="icon" type="image/x-icon" href="/logo.ico">
<meta charset="UTF-8">
<title>Admin Upload | TopNotch Assets</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  padding:40px;
  background:#070814;
  color:#fff;
  font-family:Inter,system-ui,sans-serif;
}

.container{
  max-width:1000px;
  margin:auto;
}

h2{
  text-align:center;
  margin-bottom:10px;
}

.model-box{
  background:#0f1324;
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
}

input{
  width:100%;
  padding:12px 14px;
  margin-bottom:10px;
  border-radius:12px;
  background:#11162a;
  border:1px solid rgba(255,255,255,.1);
  color:#fff;
}

button{
  padding:14px 20px;
  border:none;
  border-radius:14px;
  background:#6467ff;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}

.add-btn{
  background:#22c55e;
}

.upload-btn{
  width:100%;
  margin-top:20px;
}
</style>
</head>

<body>

<div class="container">
  <h2>Admin Bulk Upload</h2>
  <p id="userText" style="text-align:center;color:#b8bbff"></p>

  <div id="models"></div>

  <button class="add-btn" onclick="addModel()">+ Add Another Model</button>
  <button class="upload-btn" onclick="uploadAll()">Upload All Models</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBy5JEPEcplViq8AkK-_uY8JXU5iHUM6ns",
  authDomain: "top-notch-log-data.firebaseapp.com",
  projectId: "top-notch-log-data"
});

const auth = firebase.auth();
const db = firebase.firestore();

const ADMIN_EMAILS = [
  "hphphp9011@gmail.com",
  "hrd9011@gmail.com"
];

auth.onAuthStateChanged(user=>{
  if(!user) location.href="login.html";

  if(!ADMIN_EMAILS.includes(user.email)){
    alert("Access denied");
    location.href="index.html";
  }

  document.getElementById("userText").innerText =
    "Admin logged in as " + user.email;

  addModel();
});

function addModel(){
  const box = document.createElement("div");
  box.className="model-box";

  box.innerHTML = `
    <input placeholder="Model Name">
    <input placeholder="Model RAW URL (.glb)">
    <input placeholder="MEGA Download Link">
    <input placeholder="Thumbnail RAW URL">
    <input placeholder="Category">
    <input placeholder="Game">
    <input placeholder="Tags (comma separated)">
  `;

  document.getElementById("models").appendChild(box);
}

async function uploadAll(){
  const boxes = document.querySelectorAll(".model-box");
  const user = auth.currentUser;

  for(const box of boxes){
    const inputs = box.querySelectorAll("input");

    const data = {
      name: inputs[0].value.trim(),
      modelUrl: inputs[1].value.trim(),
      downloadLink: inputs[2].value.trim(),
      thumbnail: inputs[3].value.trim(),
      category: inputs[4].value.trim(),
      game: inputs[5].value.trim(),
      tags: inputs[6].value.split(",").map(t=>t.trim()).filter(Boolean),
    };

    if(!data.name || !data.modelUrl || !data.thumbnail) continue;

    await db.collection("models").add({
      ...data,
      name_lower: data.name.toLowerCase(),
      status: "approved",
      likesCount: 0,
      downloadsCount: 0,
      uploadedBy: user.uid,
      uploaderEmail: user.email,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
  }

  alert("All models uploaded successfully ðŸš€");
  document.getElementById("models").innerHTML="";
  addModel();
}
</script>

</body>
</html>
