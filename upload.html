<!DOCTYPE html>
<html lang="en">
<head>
   <link rel="icon" type="image/x-icon" href="/logo.ico">
<meta charset="UTF-8">
<title>Upload | TopNotch Assets</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#070814;
  --card:#0f1324;
  --border:rgba(255,255,255,.08);
  --accent:#6467ff;
  --text:#ffffff;
  --muted:#b8bbff;
  --success:#22c55e;
  --error:#ef4444;
}

*{box-sizing:border-box;font-family:Inter,system-ui,sans-serif}

body{
  margin:0;
  min-height:100vh;
  padding:40px;
  color:var(--text);
  background:
    radial-gradient(800px 800px at 50% 20%, rgba(100,103,255,.25), transparent 65%),
    linear-gradient(180deg,#070814,#05060f);
}

/* ================= LAYOUT ================= */
.wrapper{
  max-width:1100px;
  margin:auto;
  display:grid;
  grid-template-columns: 520px 1fr;
  gap:40px;
}

/* ================= FORM CARD ================= */
.form{
  background:var(--card);
  padding:34px 30px;
  border-radius:22px;
  border:1px solid var(--border);
  box-shadow:0 40px 90px rgba(0,0,0,.6);
}

h2{
  text-align:center;
  font-size:30px;
  margin-bottom:6px;
}

#userText{
  text-align:center;
  font-size:14px;
  color:var(--muted);
  margin-bottom:26px;
}

input{
  width:100%;
  padding:14px 16px;
  margin-bottom:14px;
  border-radius:14px;
  background:rgba(255,255,255,.04);
  border:1px solid var(--border);
  color:#fff;
  font-size:14px;
}

input::placeholder{color:rgba(184,187,255,.6)}

input:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(100,103,255,.35);
}

button{
  width:100%;
  padding:15px;
  border:none;
  border-radius:16px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  color:#fff;
  background:linear-gradient(135deg,#6467ff,#8e90ff);
  margin-top:10px;
}

.back-home{
  display:inline-block;
  margin-top:18px;
  font-size:14px;
  color:#fff;
  text-decoration:none;
}

.back-home:hover{color:var(--accent)}

/* ================= NOTE PANEL ================= */
.note{
  background:linear-gradient(180deg,#0c1024,#080b1a);
  padding:28px;
  border-radius:22px;
  border:1px solid var(--border);
  box-shadow:0 30px 70px rgba(0,0,0,.55);
}

.note h3{
  font-size:20px;
  margin-bottom:14px;
  color:#6467ff;
}

.note p{
  font-size:14px;
  line-height:1.7;
  color:#e5e7ff;
  margin-bottom:14px;
}

.note ul{
  padding-left:18px;
  font-size:14px;
  color:#cfd3ff;
}

.note li{margin-bottom:10px}

.note code{
  background:#020617;
  padding:4px 6px;
  border-radius:6px;
  font-size:13px;
  color:#9aa4ff;
}
</style>
</head>

<body>

<div class="wrapper">

  <!-- ================= FORM ================= -->
  <div class="form" id="form" style="display:none">

    <h2>Upload Model</h2>
    <p id="userText">Checking login...</p>

    <input id="name" placeholder="Model Name">
    <input id="modelUrl" placeholder="Model RAW URL (.glb only)">
    <input id="downloadLink" placeholder="MEGA Download Link">
    <input id="thumbnail" placeholder="Thumbnail RAW Image URL">
    <input id="category" placeholder="Category (character, weapon, car)">
    <input id="game" placeholder="Game (BloodStrike, Valorant etc)">
    <input id="tags" placeholder="Tags (comma separated)">

    <button onclick="uploadModel()">Upload Model</button>

    <a href="index.html" class="back-home">‚Üê Back to Home</a>
  </div>

  <!-- ================= NOTE ================= -->
  <div class="note">
    <h3>Important Upload Instructions</h3>

    <p>
      This platform does <strong>not host files directly</strong>.  
      To keep the system fast, free, and scalable, you must upload your files to your own GitHub account.
    </p>

    <ul>
      <li>
        <strong>Model Preview:</strong>  
        Only <code>.glb</code> files are supported.
      </li>
      <li>
        <strong>Thumbnail:</strong>  
        Upload a high-quality image (PNG/JPG) to GitHub.
      </li>
      <li>
        <strong>RAW Links Required:</strong>  
        Normal GitHub links will NOT work.
      </li>
      <li>
        Convert your GitHub file URL to a RAW link using:
        <br>
        <code>raw.githubusercontent.com</code>
      </li>
      <li>
        Example:
        <br>
        <code>
        https://raw.githubusercontent.com/username/repo/main/model.glb
        </code>
      </li>
      <li>
        <strong>Tags:</strong>  
        Add all relevant keywords (character, fps, sci-fi, military, realistic, game-ready, lowpoly, etc).
      </li>
    </ul>

    <p>
      ‚ö†Ô∏è Models without correct RAW links will not preview correctly.
    </p>
  </div>

</div>

<!-- ================= FIREBASE ================= -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBy5JEPEcplViq8AkK-_uY8JXU5iHUM6ns",
  authDomain: "top-notch-log-data.firebaseapp.com",
  projectId: "top-notch-log-data"
});

const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(user=>{
  if(!user){
    location.href="login.html";
  }else{
    document.getElementById("userText").innerText =
      "Logged in as " + user.email;
    document.getElementById("form").style.display="block";
  }
});

/* ================= UPLOAD MODEL ================= */
function uploadModel(){
  const user = auth.currentUser;
  if(!user){
    showToast("Login required", "error");

    return;
  }

  // ‚úÖ FIXED VARIABLE NAMES
  const modelName   = document.getElementById("name").value.trim();
  const modelUrlVal = document.getElementById("modelUrl").value.trim();
  const downloadVal = document.getElementById("downloadLink").value.trim();
  const thumbVal    = document.getElementById("thumbnail").value.trim();
  const categoryVal = document.getElementById("category").value.trim();
  const gameVal     = document.getElementById("game").value.trim();
  const tagsVal     = document.getElementById("tags").value
                        .split(",")
                        .map(t=>t.trim())
                        .filter(Boolean);

  // ‚úÖ VALIDATION
  if(!modelName || !modelUrlVal || !downloadVal || !thumbVal){
    showToast("Please fill all required fields", "error");

    return;
  }

  if(!modelUrlVal.toLowerCase().endsWith(".glb")){
   showToast("Only .glb files are allowed", "error");

    return;
  }

  // ‚úÖ SAVE DIRECTLY TO FIRESTORE (NO BACKEND)
  db.collection("models").add({
    name: modelName,
    name_lower: modelName.toLowerCase(),
    modelUrl: modelUrlVal,
    downloadLink: downloadVal,
    thumbnail: thumbVal,
    category: categoryVal,
    game: gameVal,
    tags: tagsVal,

    status: "approved", // ‚úÖ SIMPLE MODE
    likesCount: 0,
    downloadsCount: 0,

    uploadedBy: user.uid,
    uploaderEmail: user.email,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(()=>{
    showToast("Model uploaded successfully üöÄ", "success");

    document.querySelectorAll("input").forEach(i=>i.value="");
  })
  .catch(err=>{
    showToast("Upload failed: " + err.message, "error");

  });
}


function showToast(message, type = "success") {
  const toast = document.getElementById("toast");

  toast.textContent = message;

  toast.style.background =
    type === "error"
      ? "linear-gradient(135deg,#ef4444,#dc2626)"
      : "linear-gradient(135deg,#22c55e,#16a34a)";

  toast.style.opacity = "1";

  setTimeout(() => {
    toast.style.opacity = "0";
  }, 3000);
}

</script>
<div id="toast" style="
  position: fixed;
  top: 24px;
  left: 50%;
  transform: translateX(-50%);
  min-width: 320px;
  max-width: 420px;
  padding: 16px 22px;
  border-radius: 16px;
  font-size: 15px;
  font-weight: 600;
  text-align: center;
  color: #fff;
  background: #111827;
  box-shadow: 0 25px 60px rgba(0,0,0,.7);
  opacity: 0;
  pointer-events: none;
  transition: .3s ease;
  z-index: 9999;
"></div>

</body>
</html>
